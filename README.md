# fastify-app

> Opinionated feature pack (of packages) to bootstrap a fastify app

## Features

* decorates your app with __`name`__, __`version`__ and __`root`__-path read from package.json
* decorates your app with any given __`config`__
* provides __OpenAPI 3.0__ docs by use of [fastify-oas](https://github.com/SkeLLLa/fastify-oas)
* enables extra __security__ headers as provided by __helmet__ [fastify-helmet](https://github.com/fastify/fastify-helmet)
* provides extra __sensible defaults__ provided by [fastify-sensible](https://github.com/fastify/fastify-sensible)
* uses [fastify-autoload](https://github.com/fastify/fastify-autoload) to __load plugins, models, services, whatever__ from configurable directories
* provides __monitoring healthcheck__ endpoint by use of [under-pressure](https://github.com/fastify/under-pressure)

All those features are ready setup with defaults, that may be customized further to your likings.

## Install

```sh
$ yarn add @uscreen.de/fastify-app # or use npm -i
```

## Example 

```js
// require @uscreen.de/fastify-app
const defaultApp = require('@uscreen.de/fastify-app')

// register with defaults
fastify.register(defaultApp)
```

This enables all default features and exposes some extra routes, like:

* `GET /documentation` - autogenerated OpenAPI 3.0 documentation of all endpoint
* `GET /status` - healthcheck endpoint return HTTP 200 `{"status":"ok"}`

## Cli

After installed as dependency this module provides an extra basic cli to scaffold a new empty project with linter settings, tests and some scripts. Invoke it via

```bash
./node_modules/.bin/fastify-app init
```

You will be asked to choose tasks that should apply:

1) Install additional devDepencies (eslint, prettier & co)
2) Configure your package.json with scripts and githooks
3) Copy required dotfiles (ie. .eslintrc.js, .prettierrc, etc.) to your directory

> __NOTE:__ No files will be overriden by that operation if they already exist. But within package.json the following scripts will get added/modified: `lint`, `test`, `test:cov`, `test.ci` plus `pre-commit` and `lint-staged` sections. Be sure to have commited your last state to repository before running that `init` command.

## Options

All options get validated and defaulted to a defined json-schema you can check in [config.js](./config.js) Overview of options:

| option          | Description                                                                                                                                                                                                                                                                               | Default                     | Example                          |
|-----------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------|----------------------------------|
| __autoloads__   | array of directories [fastify-autoload](https://github.com/fastify/fastify-autoload) should load your fastify plugins from. Please cosnider reading [Loading order of your plugins](https://github.com/fastify/fastify/blob/master/docs/Getting-Started.md#loading-order-of-your-plugins) | `[]`                        | `['./plugins', './services']`    |
| __swagger__     | object configuring [fastify-oas](https://github.com/SkeLLLa/fastify-oas) to generate OpenAPI 3.0 docs from your routes                                                                                                                                                                    | `{exposeRoute: true}`       | `{exposeRoute: '/docs'}`         |
| __healthCheck__ | object configuring [under-pressure](https://github.com/fastify/under-pressure) to provide a monitoring healthcheck route for your app                                                                                                                                                     | `{exposeStatusRoute: true}` | `{exposeStatusRoute: '/health'}` |


## Roadmap

> TBD

## Changelog

### 0.2.0

- added cli

### 0.1.0

- added tests (100% coverage)

### 0.0.0

- project setup, linting, guidlines

